<div class="white-wrapper">
  <div class="container">
    <div class="row justify-content-center">
      <div class="sock-card">
        <% if @sock.photo? %>
        <%= cl_image_tag @sock.photo, height: 300, width: 400, crop: :fill, class: "col-xs-12 col-sm-6", alt: "no image" %>
        <% else %>
        <%= image_tag "logo.jpg", height: 300, width: 400, crop: :fill, class: "col-xs-12, col-sm-6", alt: "no image" %>
        <% end %>

        <div class="card-product-infos col-xs-12 col-sm-6">
          <div class="sock-info">
            <h2><%= @sock.title %></h2>
            <div class="detailed-info">
              <div class="detail">
                <i class="fas fa-palette"></i>
                <p><%= @sock.color %></p>
              </div>
              <div class="detail">
                <i class="fas fa-hashtag"></i>
                <p><%= @sock.pattern %></p>
              </div>
              <div class="detail">
                <i class="fas fa-cloud-sun"></i>
                <p><%= @sock.season %></p>
              </div>
            </div>
          </div>
          <div class="sock-description">
            <p><%= @sock.description %></p>
          </div>
          <div class="actions">
            <div class="sock-price">
              <p>$ <%= @sock.price %></p>
            </div>
            <div class="user-actions">
              <% if @sock.user == current_user %>

              <% if policy(@sock).edit? %>
              <div class="logged-in-user d-flex">
                <div id="update-button">
                  <i class="fas fa-pen"></i>
                  <%= link_to "Edit", edit_sock_path %>
                </div>
                <% end %>
                <% if policy(@sock).destroy? %>
                <div id="delete-button">
                  <i class="far fa-trash-alt"></i>
                  <%= link_to "Delete", sock_path(@sock),id:"delete-button", method: :delete,
                  data: { confirm: "Are you sure?" } %>
                </div>
              </div>
              <% end %>
              <% else %>

              <%= link_to "Buy this sock", new_sock_transaction_path(@sock), id:"buy-button" %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row justify-content-center">
      <div class="all-reviews">
        <div class="sock-reviews">
          <div class="overall-rating">

          <h2>About the sock owner </h2>
          <% if @user.rating != "no reviews yet" && !@user.rating.nil? %>
          <p><strong>User Rating: </strong></p>
          <div class="stars">
          <% @user.rating.times do%>
          <%# raw '<i class="fa fa-star" aria-hidden="true"></i>' %>
          <%= '⭐️' %>
          <% end %>

          </div>
          </div>
          <div class="sock-review">
            <p><strong>User Reviews</strong></p>
            <% @user.reviews.each_with_index do |review,index| %>
            <%reviewer = User.find(@ids[index]) %>
           <p><strong><%= reviewer.username %></strong></p>
           <div class="review-rating">
              <%review.rating.times do %>
              <%# raw '<i class="fa fa-star" aria-hidden="true"></i>' %>
              <%= '⭐️' %>
            <% end %>
            </div>
            <div class="review-content">
              <p><%= review.description %></p>
            </div>
            <% end %>

          <% else %>
          <%= @user.rating %>
          <p>No Reviews yet</p>
          <% end %>
          </div>
        </div>
        <div id="review-button">
          <i class="fas fa-edit"></i>
          <%= link_to "Add a review", new_review_path %>
        </div>

      </div>
    </div>

  </div>
</div>

<div
  id="map"
  style="width: 100%;
  height: 600px;"
  data-markers="<%= @markers.to_json %>"
  data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"
></div>
